FROM python:3.11-slim

WORKDIR /app

# 시스템 필수 패키지 (readability-lxml 빌드 등에 필요할 수 있음)
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc build-essential libxml2-dev libxslt1-dev \
    && rm -rf /var/lib/apt/lists/*

# 의존성 설치
COPY backend/pyproject.toml /app/
RUN pip install --no-cache-dir fastapi uvicorn pydantic-settings sqlalchemy psycopg2-binary feedparser httpx beautifulsoup4 readability-lxml celery redis click openai

# 앱 복사
COPY backend /app/backend
ENV PYTHONPATH=/app

CMD ["uvicorn", "backend.app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
